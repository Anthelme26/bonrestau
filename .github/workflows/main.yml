name: Deploy on production mode (pressingelegance.com)

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:


jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v2
   
      - name: Setup Node.js  # Descriptive step description
        uses: actions/setup-node@v3  # Use the setup-node action with a specific version
        with:
          node-version: '18'  # Specify the Node.js version

      - name: Install npm dependencies
        run: npm install  # Install npm dependencies

      - name: Build assets with Vite
        run: npm run build  # Build the assets for production using Vite

      - name: Copy .env file (adjust path if necessary)
        run: php -r "file_exists('.env') || copy('.env.example','.env');"  # Copy .env if not present

      - name: Install dependencies
        run: composer install --no-dev --optimize-autoloader  # Install composer dependencies

      - name: Deploy to cPanel with FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.2.3  # Use the FTP deploy action
        with:
          server: ${{ secrets.FTP_SERVER }}  # Use secrets for server address
          username: ${{ secrets.FTP_USERNAME }}  # Use secrets for username
          password: ${{ secrets.FTP_PASSWORD }}  # Use secrets for password
       